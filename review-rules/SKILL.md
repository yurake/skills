---
name: review-rules
description: セッションの会話から恒久的な振る舞いルールを抽出し、AGENTS.md と突き合わせて追加すべきものを提示する。出力は rules と agents_md_patch の二部構成。
---

# タスク
1. 会話履歴から恒久ルール（メタ指示）だけ抽出する。  
   - 抽出対象: 操作方針、出力様式の固定ルール、プロジェクト横断の一般原則。  
   - 抽出対象外: その場限りの依頼、特定ファイル/一時セッション限定、感想・雑談・背景説明。
2. 既存 AGENTS.md と重複・矛盾をチェックし、追加が必要なものだけ残す。  
   - 除外基準: 既存ルールと同義、一時的・コンテキスト限定、曖昧で誤適用リスクが高いもの。
3. 以下フォーマットで出力する。

# 出力フォーマット
# rules
- （人間が読む用の新規ルール一覧。1 行 1 ルールで簡潔に。）

# agents_md_patch
```markdown
- （AGENTS.md にそのまま追記できるMarkdown行）
- ...
```

# 手順
1. 会話全体を確認し、恒久ルール候補を箇条書きで洗い出す。
2. AGENTS.md を参照し、重複/矛盾を除外する。
3. 残ったものを「rules」リストに簡潔にまとめる。
4. AGENTS.md に追記する場合の Markdown 行を「agents_md_patch」ブロックに列挙する。

# 実行タイミングのヒント
- セッションが一区切りしたとき（タスク完了やまとめ時）。
- 新しい恒久ルールが会話で合意されたと感じたとき。
- AGENTS.md に無い方針が複数出てきたとき。
